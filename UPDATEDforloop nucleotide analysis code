#Density Analysis: 
library(tidyverse)
library(data.table)
library(matrixStats)
library(dplyr)

setwd("/Users/caroline/Desktop/srd_github/RNAplfold_analyzed")
setwd("/Users/caroline/Downloads")
threeprimeutr <- fread("3'_UTRs.csv", header = TRUE)

#Link together the different CSV's to their gene from the 3'UTR file, but make sure to only pull PSUs!!
#First, make sure that we are only pulling out PSUs by only pulling out 3'UTR genes that have a dGnt that are greater than -0.25
PSUsonly <- threeprimeutr %>%
  filter(threeprimeutr$`Delta G per Nucleotide` > -0.25)

#Match up the different csvs to the PSUsonly dataframe: 
#I don't to load in everything manually..what to do
#Give me a list of all the PSUs so I can load them in? 
numbernames <- PSUsonly$`mRNA Number`

setwd("/Users/caroline/Desktop/srd_github/RNAplfold_analyzed")
temp<-read.csv(paste0("../RNAplfold_analyzed/", numbernames[1], ".csv"))
df <- as.data.frame(matrix(NA, ncol=1000, nrow=length(numbernames)))
n=1

for(everyutr in numbernames) {
  tryCatch({
  temp <- read.csv(paste0("../RNAplfold_analyzed/", everyutr, ".csv"))
  if (ncol(df) < nrow(temp)){
    add_df <- as.data.frame(matrix(NA, ncol=(nrow(temp) - ncol(df)), nrow=length(numbernames)))
    df <- cbind(df,add_df)
    #ncol(df) = nrows(temp)
  }
  temp$X2 -> df[n, 2:(nrow(temp) + 1)]
  df[n,1] <- everyutr
  n=n+1
  }
,error = function(df) print(paste(everyutr, "is a error")))
}

#There were 50+ "warnings", definitely save this dataframe into another file: 
#write.csv(df,"/Users/caroline/Desktop/srd_github/FINALsmallempty.csv", quote = F, row.names = F) #saved into the folder 
write.csv(df, "/Users/caroline/Desktop/srd_github/FINALdensitydf.csv")

#Now...to do analyses on all this PSU nucleotide by nucleotide data! 
#heatmap(df[1:10,1:10])
#hist(df[2,])
#df[2,]
#heatmap(df)
#heatmap(as.matrix(df[-1, -1]))
